<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .card {
            border-radius: 10px;
        }
        .huge {
            background-color: #ffcccb; /* Rosso chiaro per mostri grandi */
        }
        .beast {
            background-color: #c6e2ff; /* Blu chiaro per bestie */
        }
        .text-highlight {
            font-weight: bold;
        }
        /* Stili generali per il blocco statistiche */
        .card-body {
        font-family: 'Georgia', serif; /* Ispirato al font classico, puoi sostituirlo */
        border: 2px solid #000;
        padding: 15px;
        margin-bottom: 20px; /* Spazio sotto il blocco */
        background-color: #fff; /* Sfondo bianco */
        color: #000; /* Testo nero */
        line-height: 1.4; /* Interlinea per la leggibilità */
        }

        /* Titolo creatura (Elefante) */
        .card-title {
        font-size: 2em;
        margin-top: 0;
        margin-bottom: 0.2em;
        font-weight: bold; /* Potrebbe essere già bold di default, ma lo specifichiamo */
        }

        /* Sottotitolo creatura (Huge beast...) */
        .creature-subtitle {
        font-size: 1em;
        font-style: italic; /* Testo in corsivo come nell'immagine */
        margin-top: 0.2em;
        margin-bottom: 1em;
        }

        /* Container per statistiche base (Armor Class, Hit Points, Speed) */
        .stats-container {
        margin-bottom: 1em;
        }

        /* Linea singola di statistica (Armor Class 12...) */
        .stat-line {
        display: flex; /* Usa flexbox per allineare label e valore */
        margin-bottom: 0.3em;
        }

        .stat-line dt {
        font-weight: bold;
        margin-right: 0.5em; /* Spazio tra label e valore */
        }

        .stat-line dd {
        margin: 0; /* Rimuove il margin predefinito di dd */
        }

        /* Sezione Ability Scores (STR DEX CON...) */
        .ability-scores {
        margin-bottom: 1.5em;
        border-bottom: 1px solid #ccc; /* Linea divisoria sotto Ability Scores */
        padding-bottom: 0.5em;
        }

        /* Header delle Ability Scores (STR DEX CON...) */
        .ability-header {
        display: flex;
        justify-content: space-between; /* Spazia le abbreviazioni */
        font-weight: bold;
        text-align: center; /* Centra il testo delle intestazioni */
        margin-bottom: 0.2em;
        }

        .ability-header span {
        flex-grow: 1; /* Distribuisce lo spazio equamente tra le intestazioni */
        flex-basis: 0; /* Evita che il contenuto interno influenzi la larghezza iniziale */
        }

        /* Valori delle Ability Scores (22 (+6) ...) */
        .ability-values {
        display: flex;
        justify-content: space-between; /* Spazia i valori */
        text-align: center; /* Centra i valori */
        }

        .ability-values span {
        flex-grow: 1; /* Distribuisce lo spazio equamente tra i valori */
        flex-basis: 0; /* Evita che il contenuto interno influenzi la larghezza iniziale */
        }


        /* Sezioni Traits e Actions */
        .traits-section,
        .actions-section {
        margin-bottom: 1.5em;
        }

        /* Titoli di sezione (Traits, Actions) */
        .traits-section h3,
        .actions-section h3 {
        font-size: 1.4em;
        margin-top: 0;
        margin-bottom: 0.5em;
        font-weight: bold;
        border-bottom: 1px solid #ccc; /* Linea divisoria sotto i titoli di sezione */
        padding-bottom: 0.2em;
        }

        /* Singolo Trait o Action */
        .trait,
        .action {
        margin-bottom: 1em;
        }

        /* Titolo del Trait o Action (Carica travolgente, Incornata...) */
        .trait h4,
        .action h4 {
        font-weight: bold;
        margin-top: 0;
        margin-bottom: 0.3em;
        }

        /* Paragrafo di descrizione per Traits e Actions */
        .trait p,
        .action p {
        margin-top: 0;
        margin-bottom: 0;
        }

        .col-3 {
            width: 30%;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <h1 class="text-center">DND 5E Mostri</h1>
        <div class="mb-3">
            <input type="text" id="searchInput" class="form-control" placeholder="Prova con &quot;orca&quot;...">
        </div>
        <div class="mb-3 filtri">
            <div class="col-3">
            <label for="crFilter" class="form-label">GS:</label>
            <select id="crFilter" class="form-select">
                <option value="">Tutti</option> <!-- Opzione per mostrare tutti -->
                <option value="0">0</option>
                <option value="1/8">1/8</option>
                <option value="1/4">1/4</option>
                <option value="1/2">1/2</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
            </div>
        </div>
        
        <div class="row" id="monsterContainer"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchInput = document.getElementById("searchInput");
            const crFilter = document.getElementById("crFilter");
            const monsterContainer = document.getElementById("monsterContainer");
            

            function fetchMonsters() {
                const query = searchInput.value;
                const selectedCR = crFilter.value; // Ottiene il valore selezionato
                fetch(`http://127.0.0.1:5000/api/monsters?search=${query}`)
                    .then(response => response.json())
                    .then(data => {
                        monsterContainer.innerHTML = "";
                        // Filtra i mostri in base al CR selezionato
                        const filteredMonsters = data.filter(monster => 
                            selectedCR === "" || monster.challenge_rating == selectedCR
                        );

                        filteredMonsters.forEach(monster => {
                            const monsterClass = monster.type && monster.type.toLowerCase().includes("beast") ? "beast" : "huge";
                            const monsterCard = `<div class="col-md-4">
                                <div class="card mb-3 ${monsterClass}">
                                    <div class="card-body">
                                        <h5 class="card-title">${monster.name}</h5>
                                        <p class="card-text creature-subtitle"><span class="text-highlight">Tipo:</span> ${monster.type}</p>
                                        <p class="card-text"><span class="text-highlight">GS:</span> ${monster.challenge_rating}</p>
                                        <div class="stats-container">                
                                            <div class="stat-line"><dt>Armor Class:<dt>Classe Armatura</dt><dd> ${monster.armor_class}</dd>
                                                </div>
                                            <div class="stat-line"><dt>Punti Ferita:</dt> <dd>${monster.hit_points}</dd>
                                                </div>
                                            <div class="stat-line"><dt>Velocità:</dt> <dd>${monster.speed}</dd>
                                        </div>
                                        <div class="ability-scores">
                                            <div class="ability-header">
                                                <span>FOR</span>  
                                                <span>DES</span>  
                                                <span >COS</span>  
                                                <span>INT</span>  
                                                <span>SAG</span>  
                                                <span>CAR</span>
                                            </div>
                                            <div class="ability-values">
                                                <span>${monster.abilities["STR"]}</span>
                                                <span>${monster.abilities["DEX"]}</span>
                                                <span>${monster.abilities["CON"]}</span>
                                                <span>${monster.abilities["INT"]}</span>
                                                <span>${monster.abilities["WIS"]}</span>
                                                <span>${monster.abilities["CHA"]}</span>
                                            </div>
                                        </div>
                                        <div class="traits-section">
                                            <h3>Tratti</h3> 
                                            <div class="trait">${monster.traits.map(trait => `<strong>${trait.name}:</strong> ${trait.content}`).join("<br>")}</div>
                                        </div>
                                        <div class="actions-section">
                                            <h3>Azioni</h3> 
                                            <div class="action">${monster.actions.map(action => `<strong>${action.name}:</strong> ${action.content}`).join("<br>")}</div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                            monsterContainer.innerHTML += monsterCard;
                        });
                    });
            }

            // Ricarica i mostri ogni volta che cambia il filtro o la ricerca
            searchInput.addEventListener("input", fetchMonsters);
            crFilter.addEventListener("change", fetchMonsters);

            fetchMonsters();
        });
    </script>
</body>
</html>
